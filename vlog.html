<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Blog Space</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
          },
          fontFamily: {
            sans: ['Inter', 'ui-sans-serif', 'system-ui'],
            display: ['Poppins', 'ui-sans-serif', 'system-ui'],
          },
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #ffffff;
      color: #374151;
      overflow-x: hidden;
    }
    
    #threejs-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      opacity: 0.05;
    }
    
    .gradient-text {
      background: linear-gradient(90deg, #0ea5e9, #6366f1);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f3f4f6;
    }
    ::-webkit-scrollbar-thumb {
      background: #d1d5db;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #9ca3af;
    }
    
    .blog-card {
      transition: all 0.3s ease;
      transform-style: preserve-3d;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .blog-card:hover {
      transform: translateY(-5px) scale(1.01);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    @keyframes float {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-10px);
      }
    }
    .featured-card {
      animation: float 6s ease-in-out infinite;
    }
    
    #particle-canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: -1;
    }
    
    .line-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* Modal styles */
    .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border-radius: 10px;
        width: 90%;
        max-width: 600px;
        position: relative;
        display: flex;
        flex-direction: column;
        max-height: 90vh; /* Adjust modal max height */
    }

    .close-btn {
        position: absolute;
        top: 10px;
        right: 20px;
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
    }

    .close-btn:hover,
    .close-btn:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-header {
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 10px;
      margin-bottom: 20px;
      flex-shrink: 0; /* Prevents the header from shrinking */
    }

    .modal-body {
      flex-grow: 1; /* Allows the body to take up remaining space */
      display: flex;
      flex-direction: column;
      overflow: hidden; /* Hide overflow to make the comments list scrollable */
    }

    #modal-comments-list {
        max-height: 100%; /* Take up all available space in the body */
        overflow-y: auto; /* This creates the scrollbar */
        padding-right: 15px; /* Add some padding for the scrollbar */
    }
    /* Style for the scrollbar within the comments list */
    #modal-comments-list::-webkit-scrollbar {
        width: 8px;
    }

    #modal-comments-list::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
    }

    #modal-comments-list::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
    }
    
    #modal-comments-list::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
    }

  </style>
</head>

<body class="min-h-screen">
  <nav class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16">
        <div class="flex items-center">
          <a href="#" class="text-xl font-display font-bold gradient-text flex items-center">
            <svg class="w-6 h-6 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M12 8V16" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 12H16" stroke="url(#gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <defs>
                <linearGradient id="gradient" x1="2" y1="2" x2="22" y2="22" gradientUnits="userSpaceOnUse">
                  <stop stop-color="#0ea5e9"/>
                  <stop offset="1" stop-color="#6366f1"/>
                </linearGradient>
              </defs>
            </svg>
            Aruna Ekanayake
          </a>
        </div>
        <div class="hidden md:flex items-center space-x-8">
          <a href="index.html" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">Home</a>
          <a href="index.html#about" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">About</a>
          <a href="index.html#skills" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">Skills</a>
          <a href="index.html#projects" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">Projects</a>
          <a href="index.html#experience" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">Education</a>
          <a href="index.html#contact" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">Contact</a>
          <a href="vlog.html" class="text-gray-700 hover:text-primary-600 font-medium underline-animation">Blogs</a>
        </div>
        <div class="flex items-center md:hidden">
          <button id="mobile-menu-btn" type="button" class="inline-flex items-center justify-center p-2 rounded-md text-gray-700 hover:text-primary-600 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500" aria-controls="mobile-menu" aria-expanded="false">
            <span class="sr-only">Open main menu</span>
            <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  
    <div class="md:hidden hidden" id="mobile-menu">
      <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
        <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">Home</a>
        <a href="index.html#about" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">About</a>
        <a href="index.html#skills" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">Skills</a>
        <a href="index.html#projects" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">Projects</a>
        <a href="index.html#experience" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">Education</a>
        <a href="index.html#contact" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">Contact</a>
        <a href="vlog.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:bg-primary-50">Blogs</a>
      </div>
    </div>
  </nav>

  <div id="threejs-bg"></div>
  
  <div id="particle-canvas"></div>
  
  <main class="container mx-auto px-4 py-12 max-w-6xl">
    <header class="mb-16 text-center">
      <h1 class="text-5xl md:text-6xl font-display font-bold mb-4 gradient-text">
        Knowledge <span class="inline-block">Space</span>
      </h1>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Explore thoughts, ideas, and stories in this immersive digital experience
      </p>
    </header>
    
    <section class="mb-16">
      
      <div class="featured-card bg-white rounded-2xl overflow-hidden border border-gray-200 shadow-lg mb-8">
        <div class="flex flex-col lg:flex-row">
          <div class="lg:w-1/2 h-64 lg:h-auto flex items-center justify-center p-8"
              style="background-image: url('cc.jpg'); background-size: cover; background-position: center;">
            <div class="text-center">
              <div class="text-4xl font-display font-bold mb-3 text-white">"Ella's Mystical Mountains"</div>
              <p class="text-gray-100 mb-4">A journey through misty peaks and hidden waterfalls</p>
              <div class="inline-flex items-center px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full border border-white/20 text-white">
                <span class="text-sm">Read Time: 8 min</span>
              </div>
            </div>
          </div>
          <div class="lg:w-1/2 p-8">
            <div class="flex items-center mb-4">
              <div class="w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold mr-3">AD</div>
              <div>
                <div class="font-medium text-gray-900">Aruna Darshana</div>
                <div class="text-sm text-gray-500 flex items-center space-x-2">
                  <span>Agu 7, 2025 ·</span>
                  <button class="comment-btn flex items-center text-sm text-gray-500 hover:text-gray-900" data-blog-id="1">
                    <i class="far fa-comment mr-1"></i> <span class="comment-count">0</span> comments
                  </button>
                </div>
              </div>
            </div>
            <p class="text-gray-700 mb-6">
              Have you ever dreamt of a place where the air is fresh, the scenery is breathtaking, and every corner holds a new adventure?.....
            </p>
            <div class="flex flex-wrap gap-2 mb-6">
              <span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-700">#travel</span>
              <span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-700">#adventure</span>
              <span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-700">#srilanka</span>
            </div>
            <a href="alla.html" class="px-6 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-all flex items-center w-max">
              Continue Reading
              <i class="fas fa-arrow-right ml-2"></i>
            </a>
          </div>
        </div>
      </div>
      
      <div class="featured-card bg-white rounded-2xl overflow-hidden border border-gray-200 shadow-lg">
        <div class="flex flex-col lg:flex-row">
          <div class="lg:w-1/2 h-64 lg:h-auto flex items-center justify-center p-8"
              style="background-image: url('Sigiriya_800x520.jpg'); background-size: cover; background-position: center;">
            <div class="text-center">
              <div class="text-4xl font-display font-bold mb-3 text-white">"Sigiriya's Mystical Mountains"</div>
              <p class="text-gray-100 mb-4">Climbing the lion's rock and discovering a royal past.</p>
              <div class="inline-flex items-center px-4 py-2 bg-white/10 backdrop-blur-sm rounded-full border border-white/20 text-white">
                <span class="text-sm">Read Time: 8 min</span>
              </div>
            </div>
          </div>
          <div class="lg:w-1/2 p-8">
            <div class="flex items-center mb-4">
              <div class="w-10 h-10 rounded-full bg-primary-500 flex items-center justify-center text-white font-bold mr-3">AD</div>
              <div>
                <div class="font-medium text-gray-900">Aruna Darshana</div>
                <div class="text-sm text-gray-500 flex items-center space-x-2">
                  <span>July 10, 2025 ·</span>
                  <button class="comment-btn flex items-center text-sm text-gray-500 hover:text-gray-900" data-blog-id="2">
                    <i class="far fa-comment mr-1"></i> <span class="comment-count">0</span> comments
                  </button>
                </div>
              </div>
            </div>
            <p class="text-gray-700 mb-6">
              The journey to Sigiriya was like stepping back in time. As we approached the majestic rock fortress, the giant lion paws at its base emerged from the surrounding jungle, whispering tales of a bygone era. The sight of this colossal monolith piercing the sky, especially with the morning mist swirling around it, was nothing short of a dream.......
            </p>
            <div class="flex flex-wrap gap-2 mb-6">
              <span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-700">#travel</span>
              <span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-700">#adventure</span>
              <span class="px-3 py-1 bg-gray-100 text-sm rounded-full text-gray-700">#srilanka</span>
            </div>
            <a href="test.html" class="px-6 py-2 bg-primary-600 hover:bg-primary-700 text-white rounded-lg transition-all flex items-center w-max">
              Continue Reading
              <i class="fas fa-arrow-right ml-2"></i>
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="commentsModal" class="modal">
    <div class="modal-content">
      <span class="close-btn">&times;</span>
      <div class="modal-header">
        <h2 class="text-2xl font-display font-bold text-gray-900">Comments</h2>
        <p id="modal-blog-title" class="text-sm text-gray-500 mt-1"></p>
      </div>
      <div class="modal-body">
        <div class="mb-4 flex items-center">
          <textarea id="main-comment-input" class="w-full px-3 py-2 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="Add a comment..."></textarea>
          <button id="submit-main-comment" class="ml-2 px-3 py-2 bg-primary-600 text-white rounded-full hover:bg-primary-700 flex items-center">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        <div id="modal-comments-list" class="space-y-3 mt-4">
          </div>
      </div>
    </div>
  </div>
  
  <script>
    const VERCEL_BACKEND_URL = 'https://vlog-backend.vercel.app';

    // API functions to interact with the backend
    async function fetchComments(blogId) {
        try {
            const response = await fetch(`${VERCEL_BACKEND_URL}/api/comments/${blogId}`);
            if (!response.ok) {
                throw new Error(`Error fetching comments: ${response.statusText}`);
            }
            const comments = await response.json();
            return comments;
        } catch (error) {
            console.error('Failed to fetch comments:', error);
            return [];
        }
    }

    async function postComment(commentData) {
        try {
            const response = await fetch(`${VERCEL_BACKEND_URL}/api/comments`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(commentData),
            });
            if (!response.ok) {
                throw new Error(`Error posting comment: ${response.statusText}`);
            }
            const newComment = await response.json();
            return newComment;
        } catch (error) {
            console.error('Failed to post comment:', error);
            return null;
        }
    }

    async function postReply(parentCommentId, replyData) {
        try {
            const response = await fetch(`${VERCEL_BACKEND_URL}/api/comments/${parentCommentId}/replies`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(replyData),
            });
            if (!response.ok) {
                throw new Error(`Error posting reply: ${response.statusText}`);
            }
            const updatedComment = await response.json();
            return updatedComment;
        } catch (error) {
            console.error('Failed to post reply:', error);
            return null;
        }
    }

    async function deleteComment(commentId) {
        try {
            const response = await fetch(`${VERCEL_BACKEND_URL}/api/comments/${commentId}`, {
                method: 'DELETE',
            });
            if (!response.ok) {
                throw new Error(`Error deleting comment: ${response.statusText}`);
            }
            return response.json();
        } catch (error) {
            console.error('Failed to delete comment:', error);
        }
    }

    // New render function
    async function renderCommentsForBlog(blogId) {
        const commentsList = document.getElementById('modal-comments-list');
        const commentCountSpan = document.querySelector(`.comment-btn[data-blog-id="${blogId}"] .comment-count`);

        if (!commentsList || !commentCountSpan) return;

        // Clear any existing comments
        commentsList.innerHTML = 'Loading comments...';

        const comments = await fetchComments(blogId);

        // Update comment count
        let totalCount = 0;
        function countAllComments(commentsArray) {
            if (!commentsArray) return;
            totalCount += commentsArray.length;
            commentsArray.forEach(c => {
                if (c.replies) {
                    countAllComments(c.replies);
                }
            });
        }
        countAllComments(comments);
        commentCountSpan.textContent = totalCount;

        commentsList.innerHTML = ''; // Clear loading message

        function renderComment(comment, parentId = null) {
            const dateString = new Date(comment.date).toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const newCommentDiv = document.createElement('div');
            newCommentDiv.className = `comment bg-gray-100 p-3 rounded-md relative group ${parentId ? 'ml-6 sm:ml-8' : ''}`;
            newCommentDiv.setAttribute('data-comment-id', comment._id);
            if (parentId) newCommentDiv.setAttribute('data-parent-id', parentId);

            newCommentDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-6 h-6 rounded-full bg-gray-300 mr-2"></div>
                        <span class="text-sm font-medium">${comment.author}</span>
                    </div>
                    <span class="text-xs text-gray-500">${dateString}</span>
                </div>
                <p class="text-sm mt-1">${comment.text}</p>
                <div class="flex items-center space-x-4 mt-2">
                    <button class="delete-comment-btn absolute top-2 right-2 text-red-500 hover:text-red-700 opacity-0 group-hover:opacity-100 transition-opacity p-1">
                        <i class="fas fa-trash-alt"></i>
                    </button>
                </div>
                <div class="reply-input-section mt-2 flex items-center">
                    <textarea class="reply-textarea w-full px-3 py-2 text-sm border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500" placeholder="Write a reply..."></textarea>
                    <button class="ml-2 px-3 py-2 bg-primary-600 text-white text-sm rounded-full hover:bg-primary-700 submit-reply" data-parent-id="${comment._id}">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            `;
            commentsList.appendChild(newCommentDiv);

            if (comment.replies && comment.replies.length > 0) {
                comment.replies.forEach(reply => {
                    renderComment(reply, comment._id);
                });
            }
        }

        if (comments.length > 0) {
            comments.forEach(comment => {
                renderComment(comment);
            });
        } else {
            commentsList.innerHTML = '<p class="text-center text-gray-500">No comments yet. Be the first to comment!</p>';
        }
    }

    function setupCommentFunctionality() {
        // Toggle modal when comment button is clicked
        document.querySelectorAll('.comment-btn').forEach(btn => {
            btn.addEventListener('click', async function() {
                activeBlogId = this.getAttribute('data-blog-id');
                const blogTitle = this.closest('.featured-card').querySelector('.font-display.font-bold').textContent;
                document.getElementById('modal-blog-title').textContent = blogTitle;
                await renderCommentsForBlog(activeBlogId); // Use await here
                document.getElementById('commentsModal').style.display = 'block';
            });
        });

        // Close modal
        document.querySelector('.close-btn').addEventListener('click', function() {
            document.getElementById('commentsModal').style.display = 'none';
        });

        window.addEventListener('click', function(event) {
            if (event.target == document.getElementById('commentsModal')) {
                document.getElementById('commentsModal').style.display = 'none';
            }
        });

        // Handle new comment submission (main)
        document.getElementById('submit-main-comment').addEventListener('click', async function() {
            const textarea = document.getElementById('main-comment-input');
            const commentText = textarea.value.trim();

            if (commentText && activeBlogId) {
                const commentData = {
                    blogId: activeBlogId,
                    author: 'You', // This could be dynamic later
                    text: commentText
                };

                const newComment = await postComment(commentData);

                if (newComment) {
                    textarea.value = '';
                    await renderCommentsForBlog(activeBlogId);
                }
            }
        });

        // Handle all comment list events (delegation)
        document.getElementById('modal-comments-list').addEventListener('click', async function(e) {
            // Submit reply button click
            if (e.target.closest('.submit-reply')) {
                const btn = e.target.closest('.submit-reply');
                const parentCommentId = btn.getAttribute('data-parent-id');
                const replyInputSection = btn.closest('.reply-input-section');
                const textarea = replyInputSection.querySelector('.reply-textarea');
                const replyText = textarea.value.trim();

                if (replyText && parentCommentId) {
                    const replyData = {
                        author: 'You', // This could be dynamic later
                        text: replyText
                    };
                    const updatedComment = await postReply(parentCommentId, replyData);
                    if (updatedComment) {
                        textarea.value = '';
                        await renderCommentsForBlog(activeBlogId);
                    }
                }
            }

            // Delete button click
            if (e.target.closest('.delete-comment-btn')) {
                const commentElement = e.target.closest('.comment');
                const commentId = commentElement.getAttribute('data-comment-id');

                if (commentId) {
                    const confirmation = confirm('Are you sure you want to delete this comment?');
                    if (confirmation) {
                        const response = await deleteComment(commentId);
                        if (response) {
                            await renderCommentsForBlog(activeBlogId);
                        }
                    }
                }
            }
        });
    }
    
    // Function to update initial comment counts
    async function updateInitialCommentCounts() {
      document.querySelectorAll('.comment-btn').forEach(async btn => {
        const blogId = btn.getAttribute('data-blog-id');
        const comments = await fetchComments(blogId);
        let totalCount = 0;
        function countAllComments(commentsArray) {
            if (!commentsArray) return;
            totalCount += commentsArray.length;
            commentsArray.forEach(c => {
                if (c.replies) {
                    countAllComments(c.replies);
                }
            });
        }
        countAllComments(comments);
        btn.querySelector('.comment-count').textContent = totalCount;
      });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      if (document.getElementById('threejs-bg') && typeof THREE !== 'undefined') {
        initThreeJS();
      }
      if (document.getElementById('particle-canvas') && typeof p5 !== 'undefined') {
        initP5Particles();
      }
      setupCommentFunctionality();
      updateInitialCommentCounts(); // Call new function to get initial counts
    });

    // --- Other functions from your original code (keep as-is) ---
    function initThreeJS() {
      const container = document.getElementById('threejs-bg');
      if (!container) return;
      const width = container.clientWidth;
      const height = container.clientHeight;
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
      renderer.setSize(width, height);
      container.appendChild(renderer.domElement);
      const particlesGeometry = new THREE.BufferGeometry();
      const particleCount = 500;
      const posArray = new Float32Array(particleCount * 3);
      for(let i = 0; i < particleCount * 3; i++) {
        posArray[i] = (Math.random() - 0.5) * 10;
      }
      particlesGeometry.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
      const particlesMaterial = new THREE.PointsMaterial({
        size: 0.02,
        color: 0x0ea5e9,
        transparent: true,
        opacity: 0.3,
      });
      const particlesMesh = new THREE.Points(particlesGeometry, particlesMaterial);
      scene.add(particlesMesh);
      camera.position.z = 3;
      function animate() {
        requestAnimationFrame(animate);
        particlesMesh.rotation.x += 0.0005;
        particlesMesh.rotation.y += 0.0005;
        renderer.render(scene, camera);
      }
      animate();
      window.addEventListener('resize', () => {
        const width = container.clientWidth;
        const height = container.clientHeight;
        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize(width, height);
      });
    }

    function initP5Particles() {
      if (typeof p5 === 'undefined') return;
      return new p5((p) => {
        let particles = [];
        const particleCount = window.innerWidth < 768 ? 30 : 100;
        p.setup = () => {
          const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
          canvas.parent('particle-canvas');
          canvas.elt.style.pointerEvents = 'none';
          for(let i = 0; i < particleCount; i++) {
            particles.push({
              x: p.random(p.width),
              y: p.random(p.height),
              size: p.random(2, 5),
              speedX: p.random(-0.5, 0.5),
              speedY: p.random(-0.5, 0.5),
              color: p.color(14, 165, 233, p.random(30, 80))
            });
          }
        };
        p.draw = () => {
          p.clear();
          for(let i = 0; i < particles.length; i++) {
            let particle = particles[i];
            particle.x += particle.speedX;
            particle.y += particle.speedY;
            if(particle.x > p.width) particle.x = 0;
            if(particle.x < 0) particle.x = p.width;
            if(particle.y > p.height) particle.y = 0;
            if(particle.y < 0) particle.y = p.height;
            p.noStroke();
            p.fill(particle.color);
            p.ellipse(particle.x, particle.y, particle.size);
            for(let j = i + 1; j < particles.length; j++) {
              let other = particles[j];
              let distance = p.dist(particle.x, particle.y, other.x, other.y);
              if(distance < 150) {
                p.stroke(14, 165, 233, p.map(distance, 0, 150, 30, 0));
                p.line(particle.x, particle.y, other.x, other.y);
              }
            }
          }
        };
        p.windowResized = () => {
          p.resizeCanvas(p.windowWidth, p.windowHeight);
        };
      });
    }
</script>
</body>
</html>